name: University Project - Multi-Branch CI/CD

on:
  push:
    branches: [development, staging, master]

env:
  REGISTRY: docker.io
  IMAGE_NAME: university-project
  TAG: ${{ github.ref_name }}

jobs:
  deploy:
    runs-on: self-hosted

    strategy:
      matrix:
        branch: [development, staging, master]
        include:
          - branch: development
            port: 8081
            env_file: .env.dev
            should_push: false
          - branch: staging
            port: 8082
            env_file: .env.stage
            should_push: true
          - branch: master
            port: 8080
            env_file: .env.prod
            should_push: true

    steps:
      - name: Match matrix to pushed branch
        if: github.ref_name == matrix.branch
        run: echo "Deploying branch: ${{ matrix.branch }}"

      - name: Checkout code
        if: github.ref_name == matrix.branch
        uses: actions/checkout@v4

      - name: Set up Docker Buildx
        if: github.ref_name == matrix.branch
        uses: docker/setup-buildx-action@v2

      - name: Login to Docker Hub (only staging/master)
